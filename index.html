<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- PWA / iOS Configuration -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="AI Assistant">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/4712/4712027.png">

    <title>AI Assistant - Settings Icon</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- IMPORT FONT: Inter & Orbitron (Weights 400-900) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 
                        sans: ['Inter', 'sans-serif'],
                        orbitron: ['Orbitron', 'sans-serif'] 
                    }
                }
            }
        }
    </script>

    <style>
        /* === 1. GLOBAL RESET & IOS BASE === */
        *, *::before, *::after {
            touch-action: manipulation;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden; 
            background-color: #ffffff;
            overscroll-behavior: none; 
            -webkit-overflow-scrolling: touch;
            -webkit-user-select: none; 
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        #chat-container, input, textarea {
            -webkit-user-select: text;
            user-select: text;
        }

        *:focus { outline: none; box-shadow: none; }

        /* === 2. UTILITIES === */
        #chat-container {
            -webkit-overflow-scrolling: touch;
            overscroll-behavior-y: contain;
        }

        #user-input::-webkit-scrollbar { display: none; }
        #user-input { -ms-overflow-style: none; scrollbar-width: none; }

        .safe-pt { padding-top: env(safe-area-inset-top); }
        .safe-pb { padding-bottom: env(safe-area-inset-bottom); }

        .markdown-body { font-size: 1rem; line-height: 1.6; color: #334155; }
        .markdown-body p { margin-bottom: 0.75rem; }
        .markdown-body pre { background: #e2e8f0; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; margin: 0.5rem 0; }
        .markdown-body code { font-family: monospace; background: #f1f5f9; padding: 0.1rem 0.3rem; border-radius: 0.2rem; }

        .dot-flashing {
            position: relative; width: 6px; height: 6px;
            border-radius: 50%; background-color: #94a3b8;
            animation: dot-flashing 1s infinite linear alternate; animation-delay: 0.5s;
        }
        .dot-flashing::before, .dot-flashing::after {
            content: ''; display: inline-block; position: absolute; top: 0;
            width: 6px; height: 6px; border-radius: 50%; background-color: #94a3b8;
            animation: dot-flashing 1s infinite alternate;
        }
        .dot-flashing::before { left: -10px; animation-delay: 0s; }
        .dot-flashing::after { left: 10px; animation-delay: 1s; }
        @keyframes dot-flashing { 0% { background-color: #94a3b8; } 50%, 100% { background-color: #cbd5e1; } }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="flex flex-col relative">

    <!-- === SIDEBAR & OVERLAY === -->
    <div id="sidebar-overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/20 z-40 hidden transition-opacity opacity-0 backdrop-blur-sm"></div>

    <div id="sidebar" class="fixed inset-y-0 left-0 z-50 w-72 bg-white shadow-2xl transform -translate-x-full transition-transform duration-300 ease-in-out flex flex-col">
        
        <!-- Sidebar Top Section -->
        <div class="flex-none min-h-[64px] safe-pt flex items-center px-4">
            <!-- TOMBOL PERCAKAPAN BARU -->
            <button onclick="startNewChat()" class="w-full flex items-center justify-center px-4 py-3 bg-gray-100 text-slate-700 rounded-2xl hover:bg-gray-200 active:scale-95 transition-all duration-200 group">
                <svg class="w-5 h-5 mr-3 text-slate-500 group-hover:text-slate-800 transition-colors" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719"></path>
                    <path d="M8 12h8"></path>
                    <path d="M12 8v8"></path>
                </svg>
                <span class="font-bold text-sm text-slate-700">Percakapan Baru</span>
            </button>
        </div>

        <div class="flex-1 overflow-y-auto"></div>
    </div>

    <!-- === SECTION: LOGIN PAGE === -->
    <div id="login-page" class="absolute inset-0 z-[30] flex items-center justify-center bg-gray-100 p-4 transition-all duration-300 transform">
        <div class="bg-white w-full max-w-sm p-8 rounded-2xl shadow-sm border border-gray-200 flex flex-col items-center gap-6">
            
            <div class="flex flex-col items-center justify-center text-center">
                <img src="logo.png" alt="AI Logo" class="w-24 h-24 object-contain -mt-2 mb-0 drop-shadow-sm">
                <h1 class="font-orbitron text-2xl font-extrabold text-slate-800 tracking-wider">
                    AI ASISTEN
                </h1>
            </div>

            <div class="w-full space-y-3">
                <input type="email" placeholder="Email" class="login-input w-full h-12 px-4 bg-gray-50 border border-gray-200 rounded-xl text-sm text-slate-700 placeholder:text-slate-400 focus:bg-white focus:border-slate-300 transition-all">
                <input type="password" placeholder="Password" class="login-input w-full h-12 px-4 bg-gray-50 border border-gray-200 rounded-xl text-sm text-slate-700 placeholder:text-slate-400 focus:bg-white focus:border-slate-300 transition-all">
            </div>
            
            <button onclick="enterApp()" class="w-full h-12 bg-slate-900 hover:bg-slate-800 text-white font-bold text-sm tracking-wide rounded-xl shadow-sm transition-transform active:scale-95 uppercase">
                Masuk
            </button>
        </div>
    </div>

    <!-- === SECTION: CHAT APP === -->
    <div id="chat-page" class="flex-1 flex flex-col h-full hidden opacity-0 relative bg-white w-full z-10">
        
        <!-- Header -->
        <header class="flex-none min-h-[64px] safe-pt flex items-center justify-between px-3 border-b border-gray-100 bg-white z-20 select-none">
            
            <div class="flex items-center gap-2 h-16">
                <img src="logo.png" alt="AI Icon" class="w-14 h-14 object-contain drop-shadow-sm">
                <div>
                    <h2 class="font-orbitron font-extrabold text-lg text-slate-800 tracking-wide">AI ASISTEN</h2>
                    <p class="text-[11px] text-slate-500 font-medium font-sans">
                        Artificial Intelligence
                    </p>
                </div>
            </div>

            <!-- Header Buttons (Settings & Menu) -->
            <div class="flex items-center">
                <!-- Settings Icon (No Function) -->
                <button class="p-3 text-slate-400 hover:text-slate-600 transition-colors">
                    <svg class="w-6 h-6" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                        <g id="SVGRepo_iconCarrier">
                            <g>
                                <path fill="none" d="M0 0h24v24H0z"></path>
                                <path d="M12 14v2a6 6 0 0 0-6 6H4a8 8 0 0 1 8-8zm0-1c-3.315 0-6-2.685-6-6s2.685-6 6-6 6 2.685 6 6-2.685 6-6 6zm0-2c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm9 6h1v5h-8v-5h1v-1a3 3 0 0 1 6 0v1zm-2 0v-1a1 1 0 0 0-2 0v1h2z"></path>
                            </g>
                        </g>
                    </svg> 
                </button>

                <!-- Toggle Sidebar Icon -->
                <button onclick="toggleSidebar()" class="p-3 text-slate-400 hover:text-slate-600 transition-colors">
                    <svg class="w-8 h-8" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g stroke-width="0"></g>
                        <g stroke-linecap="round" stroke-linejoin="round"></g>
                        <g> 
                            <path d="M5 7H19" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"></path> 
                            <path d="M5 12L19 12" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"></path> 
                            <path d="M5 17L19 17" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"></path> 
                        </g>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Messages Area -->
        <main id="chat-container" class="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50">
            <div class="w-full max-w-3xl mx-auto">
                <div class="bg-white border border-gray-200 p-4 rounded-2xl shadow-sm">
                    <!-- Header Pesan -->
                    <div class="flex justify-between items-center mb-1 border-b-[0.5px] border-gray-200 pb-1">
                        <span class="text-xs font-bold uppercase tracking-wide bg-gradient-to-r from-blue-600 to-cyan-500 bg-clip-text text-transparent">ASISTEN</span>
                        <span class="text-xs text-slate-400 font-sans current-time">--:--</span>
                    </div>
                    <div class="text-slate-700 leading-relaxed markdown-body">
                        Halo! Ikon pengaturan telah ditambahkan di sebelah ikon menu. Saat ini ikon tersebut belum memiliki fungsi.
                    </div>
                </div>
            </div>
        </main>

        <!-- Input Area -->
        <div class="flex-none bg-white border-t border-gray-100 px-4 pt-4 pb-6 safe-pb z-30 w-full select-none">
            <div class="w-full max-w-3xl mx-auto relative flex items-end bg-gray-100 rounded-[2rem] border border-transparent transition-all">
                
                <button class="absolute left-2 bottom-2 w-10 h-10 flex items-center justify-center rounded-full text-slate-400 hover:text-slate-700 hover:bg-gray-200 transition-colors">
                    <i class="fa-solid fa-plus text-xl"></i>
                </button>
                
                <textarea 
                    id="user-input"
                    rows="1"
                    placeholder="Ketik pesan..." 
                    class="w-full py-4 pl-14 pr-14 bg-transparent text-slate-800 text-base placeholder:text-slate-400 resize-none max-h-32 rounded-[2rem] focus:outline-none focus:ring-0"
                    style="min-height: 56px;"
                    oninput="adjustHeight(this)"
                    onkeydown="handleEnter(event)"
                ></textarea>
                
                <button id="send-btn" class="absolute right-2 bottom-2 w-10 h-10 flex items-center justify-center rounded-full bg-slate-900 text-white hover:bg-slate-800 shadow-sm transition-transform active:scale-90 disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 translate-x-0.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none">
                        <path fill="#ffffff" fill-rule="evenodd" d="M2.345 2.245a1 1 0 0 1 1.102-.14l18 9a1 1 0 0 1 0 1.79l-18 9a1 1 0 0 1-1.396-1.211L4.613 13H10a1 1 0 1 0 0-2H4.613L2.05 3.316a1 1 0 0 1 .294-1.071z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        const apiKey = ""; 
        const loginPage = document.getElementById('login-page');
        const chatPage = document.getElementById('chat-page');
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const loginInputs = document.querySelectorAll('.login-input');
        
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebar-overlay');

        function toggleSidebar() {
            const isClosed = sidebar.classList.contains('-translate-x-full');
            if (isClosed) {
                sidebar.classList.remove('-translate-x-full');
                sidebarOverlay.classList.remove('hidden');
                setTimeout(() => sidebarOverlay.classList.remove('opacity-0'), 10);
            } else {
                sidebar.classList.add('-translate-x-full');
                sidebarOverlay.classList.add('opacity-0');
                setTimeout(() => sidebarOverlay.classList.add('hidden'), 300);
            }
        }

        function startNewChat() {
            toggleSidebar();
            setTimeout(() => { window.location.reload(); }, 300);
        }

        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) event.preventDefault();
            lastTouchEnd = now;
        }, false);

        document.body.addEventListener('touchmove', (e) => {
            const isScrollableChat = e.target.closest('#chat-container');
            const isScrollableSidebar = e.target.closest('#sidebar'); 
            const isInput = e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA';
            if (!isScrollableChat && !isInput && !isScrollableSidebar) e.preventDefault();
        }, { passive: false });

        const resetScroll = () => {
            window.scrollTo(0, 0);
            setTimeout(() => { document.body.scrollTop = 0; }, 50);
        };
        loginInputs.forEach(input => input.addEventListener('blur', resetScroll));
        userInput.addEventListener('blur', resetScroll);

        sendBtn.addEventListener('touchstart', (e) => {
            e.preventDefault(); 
            e.stopPropagation();
            sendMessage();
        }, { passive: false });

        sendBtn.addEventListener('mousedown', (e) => {
            e.preventDefault();
            sendMessage();
        });

        function enterApp() {
            loginPage.style.pointerEvents = 'none';
            loginPage.style.opacity = '0';
            setTimeout(() => {
                loginPage.classList.add('hidden');
                loginPage.style.zIndex = '-1'; 
                loginPage.style.display = 'none'; 
                chatPage.classList.remove('hidden');
                chatPage.classList.add('flex'); 
                void chatPage.offsetWidth; 
                chatPage.style.opacity = '1';
                userInput.focus();
            }, 300);
        }

        async function sendMessage() {
            const text = userInput.value.trim();
            if (!text) return;

            userInput.blur();
            userInput.value = '';
            userInput.style.height = '56px';
            sendBtn.disabled = true;

            appendMessage('user', text);
            const loadingMsg = appendMessage('model', '', true);

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: text }] }] })
                });

                const data = await response.json();
                const aiText = data.candidates?.[0]?.content?.parts?.[0]?.text || "Maaf, tidak ada respon.";

                loadingMsg.remove();
                appendMessage('model', aiText);

            } catch (error) {
                loadingMsg.remove();
                appendMessage('model', "Error koneksi jaringan.");
            } finally {
                sendBtn.disabled = false;
            }
        }

        function appendMessage(role, content, isLoading = false) {
            const div = document.createElement('div');
            div.className = 'w-full max-w-3xl mx-auto animate-[fadeIn_0.3s_ease-out]';
            
            const isUser = role === 'user';
            const bgClass = 'bg-white';
            const borderClass = 'border-gray-200';
            
            const name = isUser ? 'ANDA' : 'ASISTEN';
            const nameColorClass = isUser 
                ? 'text-slate-500' 
                : 'bg-gradient-to-r from-blue-600 to-cyan-500 bg-clip-text text-transparent';
            
            let htmlContent = isLoading 
                ? `<div class="flex items-center h-6 pl-2 gap-1"><div class="dot-flashing"></div></div>`
                : (role === 'model' ? marked.parse(content) : content.replace(/\n/g, '<br>'));

            div.innerHTML = `
                <div class="flex flex-col ${bgClass} border ${borderClass} p-4 rounded-2xl shadow-sm mb-4">
                    <div class="flex justify-between items-center mb-1 border-b-[0.5px] border-gray-200 pb-1">
                        <span class="text-xs font-bold uppercase tracking-wide ${nameColorClass}">${name}</span>
                        <span class="text-xs text-slate-400 font-sans">${getFormattedTime()}</span>
                    </div>
                    <div class="text-base text-slate-700 leading-relaxed markdown-body">
                        ${htmlContent}
                    </div>
                </div>
            `;
            chatContainer.appendChild(div);
            scrollToBottom();
            return div;
        }

        function adjustHeight(el) {
            el.style.height = 'auto';
            el.style.height = Math.min(Math.max(el.scrollHeight, 56), 128) + 'px';
        }

        function handleEnter(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        }

        function scrollToBottom() {
            chatContainer.scrollTo({ top: chatContainer.scrollHeight, behavior: 'smooth' });
        }

        function getFormattedTime() {
            return new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        document.querySelectorAll('.current-time').forEach(el => el.textContent = getFormattedTime());
    </script>
</body>
</html>
